#load this along with either the dev or prod override files

version: "3.9"

services:

  client:
    build: client
    image: 5050.ni.bbc.co.uk:8443/5050-client-dev:latest
    dns:
      - 127.0.0.11
    networks:
      - 5050_private
      - 5050_frontend
    depends_on:
      - api
    deploy:
      mode: global
      endpoint_mode: dnsrr

  api:
    build: api
    image: 5050.ni.bbc.co.uk:8443/5050-api-dev:latest
    networks:
      - 5050_private
      - 5050_frontend
    environment:
      - rt_db_name=rt
      - rt_db_host=db
      - rt_db_user=postgres
      - rt_debug=True
    secrets:
      - ni-app-tig.keytab
      - rt_app_account_pw
      - rt_db_pw
      - rt_secret
    depends_on:
      - db
    dns:
      - 127.0.0.11
      - 10.68.140.2 #bbc dns
    deploy:
      mode: global
      endpoint_mode: dnsrr

secrets:
  rt_db_pw:
    external: true
  ni-app-tig.keytab:
    external: true
  rt_app_account_pw:
    external: true
  rt_secret:
    external: true

networks:
  5050_private:
    external: true
  5050_frontend:
    external: true
